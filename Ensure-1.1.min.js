!function(){window.ensure=function(data,callback,scope){if("undefined"==typeof jQuery&&"undefined"==typeof Sys&&"undefined"==typeof Prototype)return alert("jQuery, Microsoft ASP.NET AJAX or Prototype library not found. One must be present for ensure to work");if("undefined"!=typeof data.test){var test=function(){return data.test};"string"==typeof data.test?test=function(){return!("undefined"==eval("typeof "+data.test)&&null==document.getElementById(data.test))}:"function"==typeof data.test&&(test=data.test),test()===!1||"undefined"==typeof test()||null==test()?new ensureExecutor(data,callback,scope):callback()}else new ensureExecutor(data,callback,scope)},window.ensureExecutor=function(t,e,r){this.data=this.clone(t),this.callback="undefined"==typeof r||null==r?e:this.delegate(e,r),this.loadStack=[],t.js&&t.js.constructor!=Array&&(this.data.js=[t.js]),t.html&&t.html.constructor!=Array&&(this.data.html=[t.html]),t.css&&t.css.constructor!=Array&&(this.data.css=[t.css]),"undefined"==typeof t.js&&(this.data.js=[]),"undefined"==typeof t.html&&(this.data.html=[]),"undefined"==typeof t.css&&(this.data.css=[]),this.init(),this.load()},window.ensureExecutor.prototype={init:function(){if("undefined"!=typeof jQuery)this.getJS=HttpLibrary.loadJavascript_jQuery,this.httpGet=HttpLibrary.httpGet_jQuery;else if("undefined"!=typeof Prototype)this.getJS=HttpLibrary.loadJavascript_Prototype,this.httpGet=HttpLibrary.httpGet_Prototype;else{if("undefined"==typeof Sys)throw"jQuery, Prototype or MS AJAX framework not found";this.getJS=HttpLibrary.loadJavascript_MSAJAX,this.httpGet=HttpLibrary.httpGet_MSAJAX}},getJS:function(){},httpGet:function(){},load:function(){this.loadJavascripts(this.delegate(function(){this.loadCSS(this.delegate(function(){this.loadHtml(this.delegate(function(){this.callback()}))}))}))},loadJavascripts:function(t){var e=this.data.js.length;return 0===e?t():(this.forEach(this.data.js,function(t){HttpLibrary.isUrlLoaded(t)||this.isTagLoaded("script","src",t)?e--:this.getJS({url:t,success:this.delegate(function(){e--,HttpLibrary.registerUrl(t)}),error:this.delegate(function(r){e--,"function"==typeof this.data.error&&this.data.error(t,r)})})}),void this.until({test:function(){return 0===e},delay:50,callback:this.delegate(function(){t()})}))},loadCSS:function(t){if(0===this.data.css.length)return t();var e=HttpLibrary.getHead();this.forEach(this.data.css,function(t){if(HttpLibrary.isUrlLoaded(t)||this.isTagLoaded("link","href",t));else{var r=this;try{(function(t,e){var r=document.createElement("link");r.setAttribute("href",t),r.setAttribute("rel","Stylesheet"),r.setAttribute("type","text/css"),e.appendChild(r),HttpLibrary.registerUrl(t)}).apply(window,[t,e])}catch(a){"function"==typeof r.data.error&&r.data.error(t,a.message)}}}),t()},loadHtml:function(t){var e=this.data.html.length;return 0===e?t():(this.forEach(this.data.html,function(t){HttpLibrary.isUrlLoaded(t)?e--:this.httpGet({url:t,success:this.delegate(function(r){e--,HttpLibrary.registerUrl(t);var a=this.data.parent||document.body.appendChild(document.createElement("div"));"string"==typeof a&&(a=document.getElementById(a)),a.innerHTML=r}),error:this.delegate(function(r){e--,"function"==typeof this.data.error&&this.data.error(t,r)})})}),void this.until({test:function(){return 0===e},delay:50,callback:this.delegate(function(){t()})}))},clone:function(t){var e={};for(var r in t){var a=t[r];if("object"==typeof a)if(a.constructor==Array){for(var s=[],n=0;n<a.length;n++)s.push(a[n]);e[r]=s}else e[r]=this.clone(a);else e[r]=a}return e},forEach:function(t,e){for(var r=this,a=0;a<t.length;a++)e.apply(r,[t[a]])},delegate:function(t,e){var r=e||this;return function(){t.apply(r,arguments)}},until:function(t){t.test()===!0?t.callback():window.setTimeout(this.delegate(function(){this.until(t)}),t.delay||50)},isTagLoaded:function(t,e,r){var a=document.createElement(t);a[e]=r;var s=!1,n=document.getElementsByTagName(t);return this.forEach(n,function(t){return a[e]===t[e]?(s=!0,!1):void 0}),s}};var userAgent=navigator.userAgent.toLowerCase(),HttpLibrary={browser:{version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)},loadedUrls:{},isUrlLoaded:function(t){return HttpLibrary.loadedUrls[t]===!0},unregisterUrl:function(t){HttpLibrary.loadedUrls[t]=!1},registerUrl:function(t){HttpLibrary.loadedUrls[t]=!0},createScriptTag:function(t,e,r){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",t),a.onload=a.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||e()},a.onerror=function(){r(data.url+" failed to load")};var s=HttpLibrary.getHead();s.appendChild(a)},getHead:function(){return document.getElementsByTagName("head")[0]||document.documentElement},globalEval:function(t){var e=document.createElement("script");e.type="text/javascript",HttpLibrary.browser.msie?e.text=t:e.appendChild(document.createTextNode(t));var r=HttpLibrary.getHead();r.appendChild(e)},loadJavascript_jQuery:function(t){return HttpLibrary.browser.safari?jQuery.ajax({type:"GET",url:t.url,data:null,success:function(e){HttpLibrary.globalEval(e),t.success()},error:function(e,r,a){t.error(e&&e.responseText?e.responseText:url+"\n"+a.message)},dataType:"html"}):void HttpLibrary.createScriptTag(t.url,t.success,t.error)},loadJavascript_MSAJAX:function(t){if(HttpLibrary.browser.safari){var e={url:t.url,success:function(e){HttpLibrary.globalEval(e),t.success(e)},error:t.error};HttpLibrary.httpGet_MSAJAX(e)}else HttpLibrary.createScriptTag(t.url,t.success,t.error)},loadJavascript_Prototype:function(t){if(HttpLibrary.browser.safari){var e={url:t.url,success:function(e){HttpLibrary.globalEval(e),t.success(e)},error:t.error};HttpLibrary.httpGet_Prototype(e)}else HttpLibrary.createScriptTag(t.url,t.success,t.error)},httpGet_jQuery:function(t){return jQuery.ajax({type:"GET",url:t.url,data:null,success:t.success,error:function(e,r,a){t.error(e&&e.responseText?e.responseText:"Error occured while loading: "+url+"\n"+a.message)},dataType:t.type||"html"})},httpGet_MSAJAX:function(t){var e=new Sys.Net.WebRequest;e.set_url(t.url),e.set_httpVerb("GET"),e.add_completed(function(e){var r="Failed to load:"+t.url;e.get_timedOut()&&(r="Timed out"),e.get_aborted()&&(r="Aborted"),e.get_responseAvailable()?t.success(e.get_responseData()):t.error(r)});var r=new Sys.Net.XMLHttpExecutor;e.set_executor(r),r.executeRequest()},httpGet_Prototype:function(t){new Ajax.Request(t.url,{method:"get",evalJS:!1,onSuccess:function(e){t.success(e.responseText||"")},onFailure:t.error})}}}();